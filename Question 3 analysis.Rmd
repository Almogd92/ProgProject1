---
title: "merging and apriori"
author: "Amed"
date: "24/09/2019"
output: html_document
---
# Research Question
## How does the course length affect the studentâ€™s achievements in the course?
### Methodology
##### Packages used ggplot2, knitr, dplyr, dplyr, arules and arulesViz.


I used KnitR a really important tool for reproducible research.that create documents that are a mixture of text and code; when processed through KnitR, the code is replaced by the results.I also used dplyr to provide a consistent set of verbs that helps to solve the most common data manipulation challages such as summarise() which reduces multiple values down to a single summary and this combine naturally with group_by which allows you to perform any operation "by group". 

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(knitr)
library(dplyr)
library(arules)
library(arulesViz)
```

## Merging
to analysis the research question first we were required to take data from three tables courses.csv, assessment.csv and studentAssessment.csv 
because we need join data and inorder to do that we used merge function to merge courses with assessment by tables code_module with code_presentation we had to use the by.x and by.y parameters because the matching variables have different names in the different data frames and also we have multiple columns so we used by = c("code_module", "code_presentation"),.which we called it merge1 and then we had to join merge1 with the studentsAssessment by table id_assessment in order to create a newtable2.
```{r}
courses <- read.csv("csv/courses.csv", header = TRUE, sep = ",", stringsAsFactors = FALSE)
assessments <-read.csv("csv/assessments.csv", header = TRUE, sep = ",", stringsAsFactors = FALSE)
studentassessment <- read.csv("csv/studentAssessment.csv", header = TRUE, sep = ",", stringsAsFactors = FALSE)
```


```{r merge1, include=FALSE}
merge1 <- merge(x = assessments, y = courses, by = c("code_module", "code_presentation"), all.x = TRUE)
```

```{r merge2, include=FALSE}
merge2 <- merge(x = merge1, y = studentassessment, by = "id_assessment", all.x = TRUE)
```

we created a table that groups by code_module, code_presentation, module_presentation_length, id_student and then calculate the final result by summing all the final score calculations of ((weight/100) times score)
does group by selected columns, removes all other columns.

```{r newtable2, echo=TRUE}
newtable2 <- merge2 %>%
  group_by( code_module, code_presentation, module_presentation_length, id_student) %>%
  summarise(final_result = (sum(final_score = ((weight / 100) * score))))
  newtable2 <- newtable2 [!(newtable2$final_result=="0"), ]
 
newtable2 $id_student <- NULL
newtable2<- newtable2 [complete.cases(newtable2), ]
 
newtable2$code_module <- as.factor(newtable2$code_module)
newtable2$code_presentation <- as.factor(newtable2$code_presentation)
newtable2$module_presentation_length <- as.factor(newtable2$module_presentation_length)
newtable2$final_result <- as.factor(newtable2$final_result)
 
```

```{r echo=FALSE}
tail(merge1)
```

```{r echo=FALSE}
tail(merge2)
```


```{r echo=FALSE}
tail(newtable2)
```

in order to find assocation between many variables, To perform Association Rule Mining in R, we need to use the arules and the arulesViz packages using the function "Support and Confidence".
Support is an indication of how frequently the itemset appears in the dataset and Confidence is an indication of how often the rule has been found to be true. and to find out the rules we used the apriori algorithm. 
After finishing manipulating the data, we needed to produce association rules to predict the final result by `code_module`, `code_presentation` and `module_presentation_length`. To produce the rules the packages `arules` and `arulesviz` were used. The function `apriori` was used to determine the set of rules from the new table created, using the parameters `support=0.2` and `confidence=0.15`, then I used the function `sort` to sort out the produced rules, I chose to sort them by `lift` in a decreasing order, because it showed the most values we can use on the LHS, if `support` is used the LHS doesn't show any values in it, if 'confidence' is used the LHS is `module_presentation_length` and if `lift` is used the LHS values are `code_module` and `code_presentation` mainly. 
After sorting I printed out the top 5 rules using the `inspect` function.

```{r echo=TRUE}
rules <- apriori(newtable2, parameter = list(support = 0.02, confidence = 0.15)) 
rules <- sort(rules, by = "lift", decreasing = T) 
inspect(rules[1:5]) 
```

sort the rules by support and show the top ones (5 ,head) . then test and train in next sprint.

with this research question we wanted to investigate the length of study time behaviour and acedemic achievement from Open University Learning Analytics dataset. the purpose  was to determine the different in the academic achievement of the long study time behaviour student and their short study time behaviour. this analysis used around 170,000 students are registered in several hundred modules.


